{% extends 'widgets/widget_template.html' %}
{% load custom_template %}

{% block title_color %}{{ title_color|default:'white' }}{% endblock %}
{% block title_text_color %}{{ title_text_color|default:'rgb(101, 71, 150)' }}{% endblock %}
{% block body_color %}{{ body_color|default:'white' }}{% endblock %}
{% block body_text_color %}{{ body_text_color|default:'black' }}{% endblock %}
{% block custom_title_prop %}{% if title_logo %}style="background-size: auto 60%; background-position: 50%; background-repeat: no-repeat; background-image: url('/app_resource/{{ title_logo }}');"{% endif %}{% endblock %}
{% block title1 %}{{ title1 }}{% endblock %}
{% block title2 %}{{ title2 }}{% endblock %}
{% block custom_tools %}
{% endblock %}

{% block widget_content %} <!-- Main Start Block -->

<!-- File: display_url_scan.html
  Copyright (c) 2019-2020 SlashNext Inc. (www.slashnext.com)

  Licensed under Apache 2.0 (https://www.apache.org/licenses/LICENSE-2.0.txt)
-->

<style>
.AppRunsWidget > .widget-wrapper {height: auto !important;}
*{margin: 0; padding: 0; box-sizing: border-box}
em{font-style: normal}
.temCont{margin:0 auto; max-width:1000px;width:100%;padding:0 10px}
.mainCont{font-family:'Roboto', sans-serif;font-size:13px;color:#424242;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
.mainCont * {box-sizing:border-box;margin:0;padding:0}
.full,.mainCont section,.blockDiv,.blockHead,.blockRow,.blockRow span{float:left;width:100%;}
.cr-grey1{color:#535454!important;}
.cr-grey2{color:#424242!important;}
.cr-grey3{color:#7E7E7E!important;}
.cr-blue1{color:#4A90E2!important;}
.cr-red1{color:#D0021B!important;}
.cr-green1{color:#006400!important;}
.cr-orange1{color:#FFD700!important;}
.fs-17{font-size:17px!important}
.fs-13{font-size:13px!important}
.fs-11{font-size:11px!important}
.br-top-3{border-top:3px solid #535454;}
.br-gray{border:1px solid #D8D8D8;}
.br-gray-bottom{border-bottom:1px solid #D8D8D8;}
.br-gray-right{border-right:1px solid #D8D8D8;}
.br-gray-top{border-top:1px solid #D8D8D8!important;}
.bg-blue2{background:rgba(74,144,226,.15)!important;}
.bg-grey1{background:#535454!important;}
.bg-grey4{background:#EFEFEF!important;}
.bttn{margin-right: 15px; text-decoration:none;display:inline-block;background:#535454;height:40px;border-radius:4px;padding:0 15px;line-height:38px;border:1px solid #535454;font-size:13px;color:#fff!important;}
.bttn:hover{opacity: .8;}
.fw-500{font-weight:500!important}
.mb-5{margin-bottom:5px!important}
.mb-10{margin-bottom:10px!important}
.mb-15{margin-bottom: 15px!important}
.mb-20{margin-bottom: 20px!important}
.mb-30{margin-bottom: 30px!important}
.mt-20 {margin-top: 20px!important;}
.mb-20-red1{margin-bottom: color:#D0021B!important; 20px!important}
.mainCont h2{font-size: 17px!important;font-weight: 500!important;line-height: 31px!important}
.mainCont h3{font-size: 13px!important;font-weight: 400!important;line-height: 16px!important;word-break: break-all;}
.mainCont label{color: #7E7E7E!important;font-size: 11px!important;float: left;width: 100%;}
.blockDiv{float: left;border-left: 1px solid #D8D8D8;border-top:3px solid #535454;}
.blockHead div{float: left;padding: 10px 15px;border-right:1px solid #D8D8D8;border-bottom:1px solid #D8D8D8;}
.blockHead label{margin-bottom: 5px;}
.blockHead span {font-size: 13px;text-overflow: ellipsis;overflow: hidden; word-wrap: break-word;}
.blockHead2 div{width: 80%;}
.blockHead2 div:last-child{width: 20%;}
.blockRow div{float: left;padding: 10px 15px;border-right:1px solid #D8D8D8;border-bottom:1px solid #D8D8D8;}
.blockRow label{margin-bottom: 5px;}
.blockRow span {font-size: 13px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;}
.blockRow4 div{width: 20%;}
.blockRow4 div:last-child{width: 40%;}
.blockRow5 div{width: 20%;}
.blockRow3 div{width: 33.33%;}
.blockRow2 div{width: 80%;}
.blockRow2 div:last-child{width: 20%;}
.img-enlarge img {cursor: nesw-resize;max-width: 100%;}
.popupContainer {position: fixed;width: 100%;height: 100%;background: rgba(255,255,255,.9);z-index: 99!important;display: none;left: 0;top: 0;text-align: center;overflow: auto;}
.popupContainer .crossIco {position: absolute;top: 100px!important;right: 100px!important;z-index!important: 100;color: #fff;background: #535454;width: 35px;height: 35px;text-align: center;line-height: 35px;border-radius: 50%;font-size: 25px;font-weight: bold;text-decoration: none;}
.popupContent {padding:200px 50px;}
.popupContent img {max-width: 100%;}
.full{margin-left:0!important;margin-right:0!important;}
@element .mainCont and (max-width: 700px) {
.mainCont .blockHead div {min-width: 100%;}
.mainCont .blockRow div {min-width: 100%;}
.mainCont .blockRow label{font-size: 10px!important;}
.mainCont .blockRow span{font-size: 12px!important}
div.mainCont h3 {font-size: 12px !important;}
div.mainCont h2 {font-size: 14px !important; line-height: 20px !important;}
.mainCont .blockHead {display: block;}
}
.blockHead {
	display: -webkit-flex;
    display: flex;
}
</style>

<div style="overflow: auto; width: 100%; height: 100%; padding-left:10px; padding-right:10px"> <!-- Main Div -->
	<div class="mainCont">

		{% for result in results %} <!-- Loop for each result -->

			<section class="mb-20 mt-20">
				<!-- Scan Report section -->
				<h2 class="mb-10">SlashNext Phishing Incident Response - URL Scan</h2>

				<h3 class="mb-5">action = url scan</h3>
				<h3 class="mb-5">url = {{result.param.url}}</h3>

				{% if result.data %} <!-- URL scan report request condition -->

					{% if result.data.0.errorNo == 0 %} <!-- URL scan success condition -->

						{% if result.data.0.normalizeData.normalizeStatus == 1 %}
							<!--h3 class="mb-5">url = {{result.param.url}}<em class="cr-blue1">*</em></h3-->
							<h3 class="mb-5 cr-blue1">*{{result.data.0.normalizeData.normalizeMessage}}</h3>
						{% endif %}

						<div class="blockDiv">
							<div class="blockHead blockHead2 bg-grey4">
								{% if result.data.0.urlData.threatData.verdict == "Malicious" %}
									<div><label>Scanned URL</label>
										<span>
											<a class="cr-red1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.url}}</a>
										</span>
									</div>
									<div><label>Verdict</label><span class="cr-red1">{{result.data.0.urlData.threatData.verdict}}</span></div>
								{% elif result.data.0.urlData.threatData.verdict == "Benign" %}
									<div><label>Scanned URL</label>
										<span>
											<a class="cr-green1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.url}}</a>
										</span>
									</div>
									<div><label>Verdict</label><span class="cr-green1">{{result.data.0.urlData.threatData.verdict}}</span></div>
								{% elif result.data.0.urlData.threatData.verdict == "Suspicious" %}
									<div><label>Scanned URL</label>
										<span class="cr-orange1">
											<a class="cr-orange1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.url}}</a>
										</span>
									</div>
									<div><label>Verdict</label><span class="cr-orange1">{{result.data.0.urlData.threatData.verdict}}</span></div>
								{% else %}
									<div><label>Scanned URL</label>
										<span>
											<a href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.url}}</a>
										</span>
									</div>
									<div><label>Verdict</label><span>{{result.data.0.urlData.threatData.verdict}}</span></div>
								{% endif %}
							</div>
							<div class="blockRow blockRow3">
								<div><label>Threat Status</label><span>{{result.data.0.urlData.threatData.threatStatus}}</span></div>
								<div><label>Threat Name</label><span>{{result.data.0.urlData.threatData.threatName}}</span></div>
								<div><label>Threat Type</label><span>{{result.data.0.urlData.threatData.threatType}}</span></div>
								<div><label>Scan ID</label>
									{% if result.data.0.urlData.scanId == "N/A" %}
										<span>{{result.data.0.urlData.scanId}}</span>
									{% else %}
										<span>
											<a href="javascript:;" onclick="context_menu(this, [{'contains': ['snx scan id'], 'value': '{{ result.data.0.urlData.scanId|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.scanId}}</a>
										</span>
									{% endif %}
								</div>
								<div><label>First Seen</label><span>{{result.data.0.urlData.threatData.firstSeen}}</span></div>
								<div><label>Last Seen</label><span>{{result.data.0.urlData.threatData.lastSeen}}</span></div>
							</div>

							{% if result.data.0.urlData.finalUrl %}
								<div class="blockRow blockRow2 bg-blue2">
									{% if result.data.0.urlData.threatData.verdict == "Malicious" %}
										<div><label>Final URL</label>
											<span class="cr-red1">
												<a class="cr-red1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.finalUrl|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.finalUrl}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-red1">{{result.data.0.urlData.threatData.verdict}}</span></div>
									{% elif result.data.0.urlData.threatData.verdict == "Benign" %}
										<div><label>Final URL</label>
											<span>
												<a class="cr-green1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.finalUrl|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.finalUrl}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-green1">{{result.data.0.urlData.threatData.verdict}}</span></div>
									{% elif result.data.0.urlData.threatData.verdict == "Suspicious" %}
										<div><label>Final URL</label>
											<span>
												<a class="cr-orange1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.finalUrl|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.finalUrl}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-orange1">{{result.data.0.urlData.threatData.verdict}}</span></div>
									{% else %}
										<div><label>Final URL</label>
											<span>
												<a href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.finalUrl|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.finalUrl}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span>{{result.data.0.urlData.threatData.verdict}}</span></div>
									{% endif %}
								</div>
							{% endif %}

							{% if result.data.0.urlData.landingUrl %}
								<div class="blockRow blockRow2 bg-blue2">
									{% if result.data.0.urlData.landingUrl.threatData.verdict == "Malicious" %}
										<div><label>Redirected URL</label>
											<span>
												<a class="cr-red1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.landingUrl.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.landingUrl.url}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-red1">{{result.data.0.urlData.landingUrl.threatData.verdict}}</span></div>
									{% elif result.data.0.urlData.landingUrl.threatData.verdict == "Benign" %}
										<div><label>Redirected URL</label>
											<span>
												<a class="cr-green1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.landingUrl.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.landingUrl.url}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-green1">{{result.data.0.urlData.landingUrl.threatData.verdict}}</span></div>
									{% elif result.data.0.urlData.landingUrl.threatData.verdict == "Suspicious" %}
										<div><label>Redirected URL</label>
											<span class="cr-orange1">
												<a class="cr-orange1" href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.landingUrl.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.landingUrl.url}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span class="cr-orange1">{{result.data.0.urlData.landingUrl.threatData.verdict}}</span></div>
									{% else %}
										<div><label>Redirected URL</label>
											<span>
												<a href="javascript:;" onclick="context_menu(this, [{'contains': ['url'], 'value': '{{ result.data.0.urlData.landingUrl.url|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.landingUrl.url}}</a>
											</span>
										</div>
										<div><label>Verdict</label><span>{{result.data.0.urlData.landingUrl.threatData.verdict}}</span></div>
									{% endif %}
								</div>
								<div class="blockRow blockRow3">
									<div><label>Threat Status</label><span>{{result.data.0.urlData.landingUrl.threatData.threatStatus}}</span></div>
									<div><label>Threat Name</label><span>{{result.data.0.urlData.landingUrl.threatData.threatName}}</span></div>
									<div><label>Threat Type</label><span>{{result.data.0.urlData.landingUrl.threatData.threatType}}</span></div>
									<div><label>Scan ID</label>
										{% if result.data.0.urlData.landingUrl.scanId == "N/A" %}
											<span>{{result.data.0.urlData.landingUrl.scanId}}</span>
										{% else %}
											<span>
												<a href="javascript:;" onclick="context_menu(this, [{'contains': ['snx scan id'], 'value': '{{ result.data.0.urlData.landingUrl.scanId|escapejs }}' }], 0, {{ container.id }}, null, false);">{{result.data.0.urlData.landingUrl.scanId}}</a>
											</span>
										{% endif %}
									</div>
									<div><label>First Seen</label><span>{{result.data.0.urlData.landingUrl.threatData.firstSeen}}</span></div>
									<div><label>Last Seen</label><span>{{result.data.0.urlData.landingUrl.threatData.lastSeen}}</span></div>
								</div>
							{% endif %}

						</div>

					{% elif result.data.0.errorNo == 1 %} <!-- URL scan pending condition -->
						<h3 class="mb-5">{{result.message}}</h3>
					{% else %} <!-- URL scan error condition -->
						<h3 class="mb-5 cr-red1">Error No: {{result.data.0.errorNo}}</h3>
						<h3 class="mb-5 cr-red1">Error Message: {{result.data.0.errorMsg}}</h3>
					{% endif %} <!-- URL scan success condition -->

				{% else %}
					<h3 class="mb-5 cr-red1">{{result.message}}</h3>
				{% endif %} <!-- URL scan report request condition -->

			</section>

			{% if result.param.extended_info %} <!-- Any forensic data requested condition -->

				{% if result.data.1 %} <!-- Any forensic data found condition -->

					{% for data_item in result.data %} <!-- Loop for forensic data found -->

						{% if data_item.scData %} <!-- Screenshot data found condition -->

							<section class="mb-20">
								<!-- Download Screenshot section -->
								<h2 class="mb-10">SlashNext Phishing Incident Response - Webpage Screenshot</h2>

								<div class="full"><a href="javascript:;" class="bttn download-jpeg" id="imgDwlBnt{{ forloop.parentloop.counter }}">Download Screenshot</a></div>
								<script type="text/javascript">
									function downloadImg(imgData,imgName) {
										return function() {
											var element = document.createElement('a');
											element.setAttribute('href', imgData);
											element.setAttribute('download', imgName);
											element.style.display = 'none';
											document.body.appendChild(element);
											element.click();
											document.body.removeChild(element);
										};
									};
									var image = document.createElement('img');
									image.src = "data:image/jpeg;base64," + "{{data_item.scData.scBase64}}";
									var imgData = image.src;
									var src = document.getElementById("imageSrc" + "{{ forloop.parentloop.counter }}");
									src.appendChild(image);
									var imgName = 'snx_' + '{{result.data.0.urlData.scanId}}' +'.jpeg';
									$("#imgDwlBnt" + "{{ forloop.parentloop.counter }}").click(downloadImg(imgData,imgName));
								</script>

								<section class="mt-20">
									<!-- Screenshot preview section -->
									<div class="full imgSection">
										<div class="img-enlarge full" id="imageSrc{{ forloop.parentloop.counter }}"></div>
									</div>

								</section>

							</section>

						{% endif %} <!-- Screen data found condition -->

						{% if data_item.htmlData %} <!-- HTML data found condition -->

							<section class="mb-20">
								<!-- Download HTML section -->
								<h2 class="mb-10">SlashNext Phishing Incident Response - Webpage HTML</h2>

								<div class="full"><a href="javascript:;" class="bttn download-html" id="htmlDwlBnt{{ forloop.parentloop.counter }}">Download HTML</a></div>
								<script type="text/javascript">
									function downloadHtml(htmlData,htmlName) {
										return function() {
											var element = document.createElement('a');
											element.setAttribute('href', 'data:application/html;charset=utf-8,' + encodeURIComponent(htmlData));
											element.setAttribute('download', htmlName);
											element.style.display = 'none';
											document.body.appendChild(element);
											element.click();
											document.body.removeChild(element);
										};
									};
									var htmlData = atob('{{data_item.htmlData.htmlBase64}}');
									var htmlName = 'snx_' + '{{result.data.0.urlData.scanId}}' +'.html';
									$("#htmlDwlBnt" + "{{ forloop.parentloop.counter }}").click(downloadHtml(htmlData,htmlName));
								</script>

							</section>

						{% endif %} <!-- HTML data found condition -->

						{% if data_item.textData %} <!--Text data found condition -->

							<section class="mb-20">
								<!-- Download Text section -->
								<h2 class="mb-10">SlashNext Phishing Incident Response - Webpage Text</h2>

								<div class="full"><a href="javascript:;" class="bttn download-text" id="txtDwlBnt{{ forloop.parentloop.counter }}">Download Text</a></div>
								<script type="text/javascript">
									function downloadTxt(txtData,txtName) {
										return function() {
											var element = document.createElement('a');
											element.setAttribute('href', 'data:application/html;charset=utf-8,' + encodeURIComponent(txtData));
											element.setAttribute('download', txtName);
											element.style.display = 'none';
											document.body.appendChild(element);
											element.click();
											document.body.removeChild(element);
										};
									};
									var txtData = atob('{{data_item.textData.textBase64}}');
									var txtName = 'snx_' + '{{result.data.0.urlData.scanId}}' +'.txt';
									$("#txtDwlBnt" + "{{ forloop.parentloop.counter }}").click(downloadTxt(txtData,txtName));
								</script>

							</section>

						{% endif %} <!-- Text data found condition -->

					{% endfor %} <!-- Loop for forensic data found -->

				{% elif result.message != "URL Scan Successful." and result.data.0.errorNo == 0 %} <!-- Any forensic data found alternate condition -->

					<section class="mb-20">
						<!-- No forensic data found section -->
						<h2 class="mb-10">SlashNext Phishing Incident Response - Forensics Data</h2>

						<h3 class="mb-5 cr-red1">{{result.message}}</h3>

					</section>

				{% endif %} <!-- Any forensic data found condition -->

			{% endif %} <!-- Any forensic data requested condition -->

		{% endfor %} <!-- Loop for each result end -->

	</div>
</div> <!-- Main Div -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/eqcss/1.9.2/EQCSS.min.js"></script>

<div class="popupContainer">
	<a href="javascript:;" class="crossIco">X</a>
	<div class="popupContent">
		<img src="" alt="img">
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$('.imgSection img').click(function(){
			var imgSrc = $(this).attr('src');
			$('.popupContent img').attr('src', imgSrc);
			$('.popupContainer').fadeIn();

		});
		$('.crossIco').click(function(){
			$('.popupContainer').hide();
		});
	});
</script>

{% endblock %} <!-- Main Start Block -->
